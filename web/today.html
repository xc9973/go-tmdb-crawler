<!DOCTYPE html>
<html lang="zh-CN" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; img-src 'self' data: https: http:; font-src 'self' https://cdn.jsdelivr.net; connect-src 'self'; frame-ancestors 'none';">
    <title>今日更新 - TMDB剧集管理系统</title>

    <!-- 使用系统字体，零加载时间 -->
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
    </style>

    <!-- 精简合并 CSS -->
    <link href="css/main-lite.css?v=1.1" rel="stylesheet">

    <!-- Bootstrap Icons (必需) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">

    <!-- DNS 预解析 -->
    <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <i class="bi bi-tv"></i> TMDB剧集管理系统
            </a>
            <button class="navbar-toggler" type="button" id="navbarToggle" aria-label="Toggle navigation">
                <i class="bi bi-list"></i>
            </button>
            <div class="navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li><a class="nav-link" href="/"><i class="bi bi-list-ul"></i> 剧集列表</a></li>
                    <li><a class="nav-link active" href="/today.html"><i class="bi bi-calendar-day"></i> 今日更新</a></li>
                    <li><a class="nav-link" href="/logs.html"><i class="bi bi-journal-text"></i> 爬取日志</a></li>
                    <li><a class="nav-link" href="/backup.html"><i class="bi bi-database-down"></i> 数据备份</a></li>
                </ul>
                <div class="d-flex align-items-center gap-2">
                    <button class="theme-toggle" id="themeToggle" aria-label="切换主题"></button>
                    <button class="glass-btn glass-btn-primary btn-sm" id="loginLogoutBtn" onclick="handleAuthClick()" aria-label="登录或退出">
                        <i class="bi bi-box-arrow-in-right"></i> <span id="authButtonText">登录</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid mt-4">
        <!-- Page Header with Glass Card -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="glass-card p-4">
                    <div class="d-flex justify-content-between align-items-start flex-wrap gap-3">
                        <div>
                            <h2 class="mb-1">
                                <i class="bi bi-calendar-day text-primary"></i> 今日更新
                            </h2>
                            <p class="text-muted mb-0">查看每日剧集更新情况</p>
                        </div>
                        <div class="page-header-actions d-flex gap-2 flex-wrap">
                            <button class="btn glass-btn" id="refreshBtn" aria-label="刷新数据">
                                <i class="bi bi-arrow-clockwise"></i> 刷新
                            </button>

                            <!-- 移动端下拉菜单 -->
                            <div class="dropdown d-md-none">
                                <button class="btn glass-btn glass-btn-primary dropdown-toggle" type="button"
                                        data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="bi bi-three-dots"></i> 更多
                                </button>
                                <ul class="dropdown-menu">
                                    <li>
                                        <button class="dropdown-item" id="publishTelegraphBtnMobile">
                                            <i class="bi bi-send"></i> 发布到 Telegraph
                                        </button>
                                    </li>
                                    <li>
                                        <button class="dropdown-item" id="exportMarkdownBtnMobile">
                                            <i class="bi bi-file-code"></i> 导出 Markdown
                                        </button>
                                    </li>
                                </ul>
                            </div>

                            <!-- 桌面端按钮 -->
                            <button class="btn glass-btn glass-btn-success d-none d-md-block" id="publishTelegraphBtn"
                                    aria-label="发布到 Telegraph">
                                <i class="bi bi-send"></i> 发布到 Telegraph
                            </button>
                            <button class="btn glass-btn glass-btn-primary d-none d-md-block" id="exportMarkdownBtn"
                                    aria-label="导出 Markdown">
                                <i class="bi bi-file-code"></i> 导出 Markdown
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Date Selector with Glass Cards -->
        <div class="row mb-3 g-3 date-selector-section">
            <div class="col-md-4 col-12">
                <label for="dateInput" class="form-label">选择日期</label>
                <input type="date" class="glass-select w-100" id="dateInput" style="height: 48px;"
                       aria-label="选择日期">
            </div>
            <div class="col-md-4 col-12">
                <label class="form-label">快捷选择</label>
                <div class="glass-card p-2">
                    <div class="btn-group w-100 quick-select-buttons" role="group" aria-label="快捷日期选择">
                        <button class="btn glass-btn" id="todayBtn">今天</button>
                        <button class="btn glass-btn" id="yesterdayBtn">昨天</button>
                        <button class="btn glass-btn" id="weekBtn">本周</button>
                        <button class="btn glass-btn" id="monthBtn">本月</button>
                    </div>
                </div>
            </div>
            <div class="col-md-4 col-12">
                <label class="form-label">发布状态</label>
                <div id="publishStatus" class="glass-card d-flex align-items-center justify-content-center"
                     style="height: 48px;">
                    <span class="glass-badge glass-badge-secondary">未发布</span>
                </div>
            </div>
        </div>

        <!-- Glass Statistics Cards -->
        <div class="row mb-3 g-3">
            <div class="col-md-3 col-6">
                <div class="glass-stats">
                    <div class="stat-value" id="totalCount">0</div>
                    <div class="stat-label">总更新</div>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="glass-stats">
                    <div class="stat-value text-success" id="newCount">0</div>
                    <div class="stat-label">新剧集</div>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="glass-stats">
                    <div class="stat-value text-primary" id="returningCount">0</div>
                    <div class="stat-label">续订</div>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="glass-stats">
                    <div class="stat-value" style="color: var(--glass-text-muted);" id="endedCount">0</div>
                    <div class="stat-label">完结</div>
                </div>
            </div>
        </div>

        <!-- Loading Spinner with Glass Effect -->
        <div id="loadingSpinner" class="text-center my-5">
            <div class="glass-spinner mx-auto" role="status">
                <span class="visually-hidden">加载中...</span>
            </div>
            <p class="mt-3 text-muted">加载中...</p>
        </div>

        <!-- Shows List with Glass Cards -->
        <div id="showsContent" style="display: none;">
            <div class="row g-3" id="showsContainer">
                <!-- 动态加载剧集卡片 -->
            </div>
        </div>

        <!-- Empty State with Glass Effect -->
        <div id="emptyState" style="display: none;" class="text-center my-5">
            <div class="glass-card p-5 d-inline-block">
                <i class="bi bi-calendar-x" style="font-size: 4rem; color: var(--glass-text-muted); opacity: 0.5;"></i>
                <h3 class="mt-4 mb-2">今日无更新</h3>
                <p class="text-muted mb-0">选择的日期没有剧集更新</p>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3" id="toastContainer"></div>

    <!-- Common JS -->
    <script src="js/common.js?v=2.7"></script>
    <!-- Page-specific JS -->
    <script src="js/today.js?v=2.8"></script>

    <!-- Theme Toggle Script -->
    <script>
    // Theme Management for Glassmorphism Design
    (function() {
        'use strict';

        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;

        // Get saved theme or default to dark
        const getPreferredTheme = () => {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                return savedTheme;
            }
            return 'dark'; // Default to dark theme
        };

        // Apply theme
        const setTheme = (theme) => {
            html.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            // Dispatch event for other components
            window.dispatchEvent(new CustomEvent('themeChanged', { detail: { theme } }));
        };

        // Initialize theme
        setTheme(getPreferredTheme());

        // Toggle theme on click
        if (themeToggle) {
            themeToggle.addEventListener('click', function() {
                const currentTheme = html.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                setTheme(newTheme);
            });
        }

        // Listen for system theme changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
            if (!localStorage.getItem('theme')) {
                setTheme(e.matches ? 'dark' : 'light');
            }
        });
    })();
    </script>
</body>
</html>
