<!DOCTYPE html>
<html lang="zh-CN" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https: http:; font-src 'self'; connect-src 'self'; frame-ancestors 'none';">
    <title>TMDB剧集管理系统</title>

    <!-- 使用系统字体，零加载时间 -->
    <style>
        /* 立即加载的关键 CSS - 防止 FOUC */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
    </style>

    <!-- 精简合并 CSS - 从 4 个文件合并为 1 个 -->
    <link href="css/main-lite.css?v=1.1" rel="stylesheet">

    <!-- Bootstrap Icons (必需) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">

    <!-- DNS 预解析 -->
    <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <i class="bi bi-tv"></i> TMDB剧集管理系统
            </a>
            <button class="navbar-toggler" type="button" id="navbarToggle" aria-label="Toggle navigation">
                <i class="bi bi-list"></i>
            </button>
            <div class="navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li><a class="nav-link active" href="/"><i class="bi bi-list-ul"></i> 剧集列表</a></li>
                    <li><a class="nav-link" href="/today.html"><i class="bi bi-calendar-day"></i> 今日更新</a></li>
                    <li><a class="nav-link" href="/logs.html"><i class="bi bi-journal-text"></i> 爬取日志</a></li>
                    <li><a class="nav-link" href="/backup.html"><i class="bi bi-database-down"></i> 数据备份</a></li>
                </ul>
                <div class="d-flex align-items-center gap-2">
                    <button class="theme-toggle" id="themeToggle" aria-label="切换主题"></button>
                    <button class="glass-btn glass-btn-primary btn-sm" id="loginLogoutBtn" onclick="handleAuthClick()" aria-label="登录或退出">
                        <i class="bi bi-box-arrow-in-right"></i> <span id="authButtonText">登录</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- 主内容 -->
    <div class="container-fluid mt-4">
        <!-- 页面标题 -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="glass-card">
                    <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
                        <div>
                            <h2 class="mb-1"><i class="bi bi-list-ul text-primary"></i> 剧集列表</h2>
                            <p class="text-muted mb-0">管理和浏览您的电视剧集收藏</p>
                        </div>
                        <div class="d-flex gap-2 flex-wrap">
                            <button class="glass-btn glass-btn-primary" data-modal-target="#addShowModal" aria-label="添加新剧集">
                                <i class="bi bi-plus-circle"></i> 添加剧集
                            </button>
                            <button class="glass-btn glass-btn-success" id="refreshAllBtn" aria-label="刷新所有剧集信息">
                                <i class="bi bi-arrow-clockwise"></i> 刷新全部
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 搜索和筛选 -->
        <div class="row mb-3 g-3">
            <div class="col-md-6">
                <div class="glass-card">
                    <div class="input-group">
                        <span class="input-group-text border-0 bg-transparent"><i class="bi bi-search"></i></span>
                        <input type="text" class="glass-input flex-grow-1" id="searchInput" placeholder="搜索剧集名称..." aria-label="搜索剧集">
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <select class="glass-select w-100" id="statusFilter" aria-label="筛选状态">
                    <option value="">全部状态</option>
                    <option value="Returning Series">连载中</option>
                    <option value="Ended">已完结</option>
                    <option value="Canceled">已取消</option>
                </select>
            </div>
            <div class="col-md-3">
                <select class="glass-select w-100" id="pageSizeSelect" aria-label="每页显示数量">
                    <option value="10">每页 10 条</option>
                    <option value="25" selected>每页 25 条</option>
                    <option value="50">每页 50 条</option>
                    <option value="100">每页 100 条</option>
                </select>
            </div>
        </div>

        <!-- 统计卡片 -->
        <div class="row mb-3 g-3">
            <div class="col-md-3 col-6">
                <div class="glass-stats">
                    <div class="stat-value" id="totalCount">0</div>
                    <div class="stat-label">总计</div>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="glass-stats">
                    <div class="stat-value" id="returningCount">0</div>
                    <div class="stat-label">连载中</div>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="glass-stats">
                    <div class="stat-value" id="endedCount">0</div>
                    <div class="stat-label">已完结</div>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="glass-stats">
                    <div class="stat-value" id="currentPageInfo">1/1</div>
                    <div class="stat-label">当前页</div>
                </div>
            </div>
        </div>

        <!-- 加载动画 -->
        <div id="loadingSpinner" class="text-center my-5">
            <div class="glass-spinner" role="status">
                <span class="visually-hidden">加载中...</span>
            </div>
            <p class="mt-3 text-muted">加载中...</p>
        </div>

        <!-- 剧集表格 -->
        <div class="row">
            <div class="col-12">
                <div class="glass-card">
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0" id="showsTable">
                                <thead>
                                    <tr>
                                        <th><input type="checkbox" class="form-check-input" id="selectAll" aria-label="全选"></th>
                                        <th data-sort="id" class="cursor-pointer">ID <i class="bi bi-arrow-down-up ms-1 opacity-50"></i></th>
                                        <th data-sort="name" class="cursor-pointer">名称 <i class="bi bi-arrow-down-up ms-1 opacity-50"></i></th>
                                        <th data-sort="original_name" class="cursor-pointer">原名 <i class="bi bi-arrow-down-up ms-1 opacity-50"></i></th>
                                        <th data-sort="status" class="cursor-pointer">状态 <i class="bi bi-arrow-down-up ms-1 opacity-50"></i></th>
                                        <th data-sort="first_air_date" class="cursor-pointer">首播日期 <i class="bi bi-arrow-down-up ms-1 opacity-50"></i></th>
                                        <th data-sort="vote_average" class="cursor-pointer">评分 <i class="bi bi-arrow-down-up ms-1 opacity-50"></i></th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="showsTableBody"></tbody>
                            </table>
                        </div>

                        <!-- 分页 -->
                        <nav aria-label="分页导航" class="p-3">
                            <ul class="glass-pagination" id="pagination"></ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>

        <!-- 批量操作 -->
        <div class="row mt-3" id="batchActions" style="display: none;">
            <div class="col-12">
                <div class="glass-card" style="border-left: 4px solid var(--primary);">
                    <div class="card-body">
                        <h5 class="card-title mb-2"><i class="bi bi-check-square"></i> 批量操作</h5>
                        <p class="card-text mb-3">已选择 <strong id="selectedCount">0</strong> 项</p>
                        <div class="btn-group flex-wrap gap-2">
                            <button class="glass-btn glass-btn-warning" id="batchRefreshBtn"><i class="bi bi-arrow-clockwise"></i> 批量刷新</button>
                            <button class="glass-btn glass-btn-danger" id="batchDeleteBtn"><i class="bi bi-trash"></i> 批量删除</button>
                            <button class="glass-btn" id="clearSelectionBtn"><i class="bi bi-x-square"></i> 取消选择</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 添加剧集模态框 -->
    <div class="modal" id="addShowModal" tabindex="-1" aria-hidden="true">
        <div class="modal-backdrop" data-modal-close></div>
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-plus-circle text-primary"></i> 添加剧集</h5>
                    <button type="button" class="btn-close" data-modal-close aria-label="关闭">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="addShowForm">
                        <div class="mb-3">
                            <label for="tmdbId" class="form-label">TMDB ID <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <input type="number" class="glass-input flex-grow-1" id="tmdbId" required placeholder="例如: 94997">
                                <button class="glass-btn" type="button" id="searchTmdbBtn"><i class="bi bi-search"></i> 搜索</button>
                            </div>
                            <div class="form-text mt-2">输入 TMDB ID，然后点击搜索按钮自动填充信息</div>
                        </div>
                        <div class="mb-3">
                            <label for="showName" class="form-label">名称 <span class="text-danger">*</span></label>
                            <input type="text" class="glass-input w-100" id="showName" required placeholder="剧集名称">
                        </div>
                        <div class="mb-3">
                            <label for="originalName" class="form-label">原名</label>
                            <input type="text" class="glass-input w-100" id="originalName" placeholder="原始名称（可选）">
                        </div>
                        <div class="mb-3">
                            <label for="showStatus" class="form-label">状态</label>
                            <select class="glass-select w-100" id="showStatus">
                                <option value="">自动检测</option>
                                <option value="Returning Series">连载中</option>
                                <option value="Ended">已完结</option>
                                <option value="Canceled">已取消</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="showOverview" class="form-label">简介</label>
                            <textarea class="glass-input w-100" id="showOverview" rows="3" placeholder="剧集简介（可选）"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="glass-btn" data-modal-close>取消</button>
                    <button type="button" class="glass-btn glass-btn-primary" id="saveShowBtn"><i class="bi bi-save"></i> 保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast 容器 -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3" id="toastContainer"></div>

    <!-- 脚本 - 使用 defer 异步加载 -->
    <script src="js/common.js?v=2.7" defer></script>
    <script src="js/modal.js?v=2.1" defer></script>
    <script src="js/shows.js?v=2.1" defer></script>

    <!-- 精简模态框和主题切换脚本 -->
    <script>
        (function() {
            'use strict';

            // 简化的主题切换
            const themeToggle = document.getElementById('themeToggle');
            const html = document.documentElement;

            function setTheme(theme) {
                html.setAttribute('data-theme', theme);
                localStorage.setItem('theme', theme);
            }

            // 初始化主题
            const savedTheme = localStorage.getItem('theme') || 'dark';
            setTheme(savedTheme);

            // 切换主题
            if (themeToggle) {
                themeToggle.addEventListener('click', function() {
                    const currentTheme = html.getAttribute('data-theme');
                    setTheme(currentTheme === 'dark' ? 'light' : 'dark');
                });
            }

            // 简化的移动端导航切换
            const navbarToggle = document.getElementById('navbarToggle');
            const navbarNav = document.getElementById('navbarNav');

            if (navbarToggle && navbarNav) {
                navbarToggle.addEventListener('click', function() {
                    navbarNav.classList.toggle('show');
                });
            }

            // 简化的模态框控制
            document.addEventListener('click', function(e) {
                const trigger = e.target.closest('[data-modal-target]');
                const close = e.target.closest('[data-modal-close]');

                if (trigger) {
                    const modalId = trigger.getAttribute('data-modal-target');
                    const modal = document.querySelector(modalId);
                    if (modal) modal.classList.add('show');
                }

                if (close) {
                    const modal = close.closest('.modal');
                    if (modal) modal.classList.remove('show');
                }
            });
        })();
    </script>
</body>
</html>
